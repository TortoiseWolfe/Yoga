# Implementation Plan: UX Polish

**Branch**: `039-feature-038-ux` | **Date**: 2025-11-26 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/039-feature-038-ux/spec.md`

## Summary

Fix 4 UX issues discovered during manual testing: (1) Avatar not updating in navbar after change, (2) Password validation messages at bottom of page, (3) Password update not working, (4) Find People tab missing. All fixes involve modifying existing components - no new components required.

## Technical Context

**Language/Version**: TypeScript 5.9.2, React 19, Next.js 15.5
**Primary Dependencies**: DaisyUI (alerts, forms), Supabase Auth
**Storage**: Supabase PostgreSQL (no schema changes)
**Testing**: Vitest (unit), Pa11y (a11y)
**Target Platform**: Web (PWA), responsive mobile-first
**Project Type**: Web application (Next.js App Router)
**Performance Goals**: Avatar update visible within 1 second
**Constraints**: 44px minimum touch targets, WCAG AA compliance
**Scale/Scope**: Bug-fix feature, 4 files to modify

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

| Principle                         | Status  | Notes                                          |
| --------------------------------- | ------- | ---------------------------------------------- |
| I. Component Structure Compliance | âœ… Pass | Modifying existing components, no new creation |
| II. Test-First Development        | âœ… Pass | Will update existing tests                     |
| III. PRP Methodology              | âœ… Pass | Using SpecKit workflow                         |
| IV. Docker-First Development      | âœ… Pass | All commands via docker compose exec           |
| V. Progressive Enhancement        | âœ… Pass | Inline alerts work without JS                  |
| VI. Privacy & Compliance First    | âœ… Pass | No new data collection                         |

## Project Structure

### Documentation (this feature)

```
specs/039-feature-038-ux/
â”œâ”€â”€ plan.md              # This file
â”œâ”€â”€ research.md          # Root cause analysis for all 4 issues
â”œâ”€â”€ data-model.md        # Component state changes
â”œâ”€â”€ quickstart.md        # Implementation guide
â””â”€â”€ tasks.md             # Generated by /tasks command
```

### Source Code (repository root)

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ AccountSettings/
â”‚   â”‚       â”œâ”€â”€ AccountSettings.tsx                   # MODIFY: Split error states, add refetchProfile, inline alerts
â”‚   â”‚       â”œâ”€â”€ AccountSettings.test.tsx              # MODIFY: Update tests for split error states
â”‚   â”‚       â””â”€â”€ AccountSettings.accessibility.test.tsx # MODIFY: Update for inline alerts
â”‚   â””â”€â”€ organisms/
â”‚       â””â”€â”€ UnifiedSidebar/
â”‚           â””â”€â”€ UnifiedSidebar.tsx                    # INVESTIGATE: Find People tab visibility
â”‚
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useUserProfile.ts                             # READ ONLY: refetch() method exists
â”‚
â””â”€â”€ GlobalNav.tsx                                     # READ ONLY: Already reads from profile
```

**Structure Decision**: Bug-fix feature modifying existing components. No new files created. All changes within existing patterns.

## Implementation Phases

### Phase 1: Avatar Reactive Updates (FR-001, FR-002)

| Task | File                     | Description                                               |
| ---- | ------------------------ | --------------------------------------------------------- |
| T001 | AccountSettings.tsx      | Add `refetchProfile()` after `handleAvatarUploadComplete` |
| T002 | AccountSettings.tsx      | Add `refetchProfile()` after `handleRemoveAvatar` success |
| T003 | AccountSettings.test.tsx | Update mock to verify refetchProfile called               |

### Phase 2: Split Error States (FR-003)

| Task | File                | Description                                                                                          |
| ---- | ------------------- | ---------------------------------------------------------------------------------------------------- |
| T004 | AccountSettings.tsx | Replace `error`/`success` with `profileError`/`profileSuccess` and `passwordError`/`passwordSuccess` |
| T005 | AccountSettings.tsx | Update `handleUpdateProfile` to use profile states                                                   |
| T006 | AccountSettings.tsx | Update `handleChangePassword` to use password states                                                 |

### Phase 3: Inline Alerts (FR-004, FR-005, FR-006)

| Task | File                                   | Description                                   |
| ---- | -------------------------------------- | --------------------------------------------- |
| T007 | AccountSettings.tsx                    | Add inline alerts to Profile Settings card    |
| T008 | AccountSettings.tsx                    | Add inline alerts to Change Password card     |
| T009 | AccountSettings.tsx                    | Remove bottom-of-page alerts                  |
| T010 | AccountSettings.accessibility.test.tsx | Update tests for inline alert ARIA attributes |

### Phase 4: Password Update Fix (FR-007, FR-008, FR-009)

| Task | File                | Description                                                             |
| ---- | ------------------- | ----------------------------------------------------------------------- |
| T011 | AccountSettings.tsx | Verify password update calls auth.updateUser correctly                  |
| T012 | Manual Testing      | Test password change end-to-end                                         |
| T013 | AccountSettings.tsx | Fix any issues discovered (conditional - only if T012 reveals problems) |

### Phase 5: Find People Tab (FR-010, FR-011, FR-012)

| Task | File                    | Description                                      |
| ---- | ----------------------- | ------------------------------------------------ |
| T014 | Browser DevTools        | Inspect /messages page for tab visibility issues |
| T015 | UnifiedSidebar.tsx      | Fix CSS/rendering issue (if found)               |
| T016 | UnifiedSidebar.test.tsx | Add visibility assertion for all 3 tabs          |

### Phase 6: Test Updates

| Task | File                                   | Description                                                  |
| ---- | -------------------------------------- | ------------------------------------------------------------ |
| T017 | AccountSettings.test.tsx               | Consolidate all test updates (error states + refetchProfile) |
| T018 | AccountSettings.accessibility.test.tsx | Consolidate all a11y test updates (inline alerts + ARIA)     |
| T019 | UnifiedSidebar.test.tsx                | Add/update 3-tab visibility tests                            |

### Phase 7: Validation

| Task      | File   | Description                                            |
| --------- | ------ | ------------------------------------------------------ |
| T020      | All    | Run full test suite                                    |
| T021      | All    | Type check                                             |
| T022      | All    | Lint                                                   |
| T023-T027 | Manual | Verify all 4 issues resolved in browser (see tasks.md) |

## Dependencies Between Phases

```
Phase 1 (Avatar) â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Phase 6 (Tests)
                              â–²
Phase 2 (Split States) â”€â”€â”€â”€â”€â”€â”¤
                              â”‚
Phase 3 (Inline Alerts) â”€â”€â”€â”€â”€â”¤
                              â”‚
Phase 4 (Password Fix) â”€â”€â”€â”€â”€â”€â”¤
                              â”‚
Phase 5 (Find People) â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                        Phase 7 (Validation)
```

**Single developer**: Execute sequentially (US2 â†’ US3 â†’ US1 â†’ US4) to avoid merge conflicts in AccountSettings.tsx.
**Multiple developers**: US1+US4 can run in parallel (different components); US2 must complete before US3.
Phase 6 depends on Phases 1-5.
Phase 7 depends on Phase 6.

## Risk Mitigation

| Risk                         | Mitigation                                              |
| ---------------------------- | ------------------------------------------------------- |
| Breaking existing tests      | Run tests after each phase                              |
| Accessibility regression     | Maintain ARIA attributes in new alerts                  |
| Password update still broken | Issue 3 likely masked by Issue 2 - fix visibility first |
| Find People tab CSS issue    | Check for overflow/truncation in DevTools               |

## Complexity Tracking

_No constitution violations - standard bug-fix implementation within existing patterns._

## Progress Tracking

| Phase                   | Status      | Notes                                                                                |
| ----------------------- | ----------- | ------------------------------------------------------------------------------------ |
| Phase 0: Research       | âœ… Complete | See research.md                                                                      |
| Phase 1: Avatar Updates | âœ… Complete | T001-T003: refetchProfile added to handleAvatarUploadComplete and handleRemoveAvatar |
| Phase 2: Split States   | âœ… Complete | T004-T006: profileError/profileSuccess and passwordError/passwordSuccess             |
| Phase 3: Inline Alerts  | âœ… Complete | T007-T010: Alerts moved inline with ARIA attributes                                  |
| Phase 4: Password Fix   | âœ… Complete | T011-T013: Password update was working - visibility fixed via inline alerts          |
| Phase 5: Find People    | âœ… Complete | T014-T016: Added flex-shrink-0 to tabs, overflow-x-auto to container                 |
| Phase 6: Test Updates   | âœ… Complete | T017-T019: Tests updated and passing                                                 |
| Phase 7: Validation     | ðŸ”„ Partial  | T020-T022 automated checks pass; T023-T027 manual tests pending                      |
